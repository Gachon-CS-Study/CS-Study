## 프로세스와 쓰레드

프로세스와 쓰레드를 간단하게 요약하면 다음과 같다.

| **프로세스 (Process)** | **쓰레드 (Thread)** |
| --- | --- |
| 운영체제로부터 자원을 할당 받은 **작업의 단위** | 프로세스가 할당받은 자원을 이용하는 **실행 흐름의 단위** |

## 프로그램과 프로세스

![프로그램과 프로세스](<images/프로세스와%20스레드/프로그램과%20프로세스.png>)

### 정적 프로그램

프로그램은 윈도우의 `.exe` 파일이나 Mac의 `.dmg` 파일과 같이 **컴퓨터에서 실행할 수 있는 파일**을 통칭한다.
단, 아직 **파일을 실행하지 않은 코드 덩어리 상태**이기 때문에 **정적 프로그램**, 줄여서 **프로그램**이라고 한다.

### 프로세스

프로세스는 프로그램을 실행시켜 정적을 프로그램이 동적으로 변하여 **작동하고 있는 상태**

모든 프로그램은 운영체제가 실행되기 위한 **메모리 공간을 할당**해 줘야 실행될 수 있다.
프로그램을 실행하는 순간 파일은 컴퓨터 메모리에 올라가게 되고, 운영체제로부터 자원을 할당 받아 프로그램 코드가 실행된다.

![프로세스](<images/프로세스와%20스레드/프로세스.jpeg>)

### 정리

| **프로그램** | **프로세스** |
| --- | --- |
| 어떤 작업을 실행할 수 있는 파일 | 실행되어 작업중인 컴퓨터 프로그램 |
| 저장 장치에 있고 메모리에는 올라가 있지 않음 | 메모리에 적재되고 CPU 자원을 할당받아 실행 |
| 코드 덩어리 | 코드 덩어리를 실행한 것 |

## 쓰레드

어떤 프로세스 내에서 실행되는 **흐름의 단위**
하나의 프로그램은 하나 이상의 프로세스를 가지고 있고, 하나의 프로세스는 반드시 하나 이상의 쓰레드를 갖는다.

![쓰레드](<images/프로세스와%20스레드/쓰레드.jpeg>)

### **쓰레드의 개념**

쓰레드란 하나의 프로세스 내에서 동시에 진행되는 **작업의 갈래, 흐름의 단위**를 말한다.

일반적으로 하나의 프로그램은 하나 이상의 프로세스를 가지고 있고, 하나의 프로세스는 하나 이상의 쓰레드를 갖는다. 하나의 쓰레드가 하나의 동작을 진행하는데, 여러개 있다면 **멀티 쓰레드**라고 부른다. 일반적으로 쓰레드 수가 많을수록 동시에 할 수 있는 작업이 많아져 **성능이 높아지지만 항상 장점만 있는 것은 아니다.**

### 쓰레드의 자원 공유

프로그램이 실행되어 프로세스가 만들어지면 STACK, HEAP, DATA, CODE 4가지의 메모리 영역으로 구성되어 할당받게 된다. 쓰레드는 프로세스가 할당 받은 자원을 실행하는 단위로서 **쓰레드는 STACK 영역만 할당받아 복사하고 나머지 3가지 영역은 다른 쓰레드들과 공유**한다.

![멀티쓰레드](<images/프로세스와%20스레드/멀티쓰레드.png>)

### 쓰레드가 많으면 항상 좋을까?

쓰레드가 많으면 **동시 작업이 가능**하기 때문에 **쓰레드가 많을 수록 성능이 좋아진다고 생각할 수 있다.**

**하지만 모든 상황에 대해 무조건 멀티 쓰레드가 좋다고 할 수 없다.**

### 1. 임계영역에 대한 동기화 비용

쓰레드는 **프로세스 내의 자원을 공유**하기 때문에 프로세스 생성에 비해 적은 메모리 자원을 소모하고, Context Switching도 빠르다는 장점이 있지만, 여러개의 쓰레드가 공통된 자원에 접근하기 때문에 데이터의 일관성과 정합성을 유지하기 위해 **동기화 작업**이 필요하다.

> **임계 영역 (Critical Section)**
멀티 쓰레드 환경에서 공유 자원을 접근하는 코드 영역
>

### 2. 컨텍스트 스위칭 오버헤드

멀티 프로세스를 사용할 시 컨텍스트 스위칭의 오버헤드 때문에 비교적 오버헤드가 적은 멀티 쓰레드를 사용하지만, **오버헤드 비용 자체를 무시할 수는 없다.**

**쓰레드가 많으면 많을 수록 스위칭 횟수도 많아져 오버헤드도 함께 늘어나 성능이 저하**될 수 있다.

### 3. 잉여 쓰레드의 리소스 낭비

대부분의 서비스가 24시간 일정한 양의 트래픽이 발생하지는 않을 것이다.
즉, 사용량이 적은 시간에는 불필요한 쓰레드가 많아져 시스템 자원의 낭비가 발생한다.

⇒ **잉여 쓰레드의 개수를 최소화** 하고, **쓰레드 풀** 사용같은 방법으로 리소스 낭비를 최소화 한다.

## 멀티 프로세스 와 멀티 쓰레드

### 멀티 프로세스

하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하도록 하는 것

여러 개의 자식 프로세스중 하나에 문제가 발생해도 다른 프로세스에 영향을 주지 않는다.

### 단점

**Context Switching에서의 오버헤드**

- 컨텍스트 스위칭 과정에서 캐시 메모리 초기화등 **무거운 작업이 진행**되고 **많은 시간이 소요**된다.
- 프로세스는 **각각 독립된 메모리 영역을 할당** 받기 때문에 Context Switching이 발생하면 **캐시 정보를 다시 불러와야 한다**.

> **Context Switching**이란?
CPU에서 여러 프로세스가 돌아가면서 작업을 처리하는데 이 과정이 Context Switching
동작중인 프로세스가 대기하면서 상태를 보관하고 다음 순서의 프로세스가 동작하면서 보관했던 상태를 복구하는 작업
>

### 멀티 쓰레드

하나의 프로그램을 여러개의 쓰레드로 구성하고 각 쓰레드로 하여금 하나의 작업을 처리하도록 하는 것

많은 운영체제들이 멀티 프로세싱을 지원하지만 **멀티 쓰레딩를 기본 값**으로 사용한다.

⇒ 웹 서버는 대표적인 멀티 쓰레드 프로그램이다.

### 장점

- **시스템 자원 소모 감소**
    - 프로세스를 생성하면 자원을 할당하는 과정이 줄어들어 효율적이다
- **시스템 처리량 증가**
    - 쓰레드간 작업이 많이 Context Switching이 빠르다
- **프로그램 응답시간 감소**
    - 프로세스 내의 메모리를 공유하기 때문에 통신 부담이 적다.

### 단점

- 설계가 복잡해지고 디버깅이 까다로워진다.
- 멀티 쓰레드의 경우 자원 공유에 주의를 요한다. (동시성 문제)
- 하나의 쓰레드에 문제가 발생하면 전체 프로세스가 영향을 받는다.

## 질문

1. 프로세스와 스레드의 차이를 설명하시오.
2. 멀티 쓰레드의 장단점을 설명하시오.
3. 쓰레드가 많으면 항상 좋을까? 그 이유는?

## 참고

- [[OS] 프로세스와 스레드의 차이
  ](https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html)
- [프로세스 & 스레드](https://gyoogle.dev/blog/computer-science/operating-system/Process%20vs%20Thread.html)